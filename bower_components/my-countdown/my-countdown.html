<link rel="import" href="../polymer/polymer.html">
<script src="../moment/moment.js"></script>

<!--
A countdown timer made with Polymer

##### Examples

    <my-countdown></my-countdown>

@demo
@element my-countdown
@author Eric Leichtenschlag

### Based off of http://Granze.github.io/flip-clock
-->

<dom-module id="my-countdown">
  <style>
    :host {

    }

    #clock {
      font-family: PT_Serif;
      font-weight: bold;
    }

    #clock .num {
      font-size: 40px;
      padding: 5px 15px;
      border-radius: 0px;
      color: black;
      box-shadow: 1px 1px 1px #555;
      background-color: #333;
      background: -webkit-linear-gradient(top, #0F0 0%, #444 50%, #333 51%, #222 100%);
      background: linear-gradient(to bottom, #af8aaf 0%, white 50%, #af8aaf 100%);
    }

    #clock .header {
      font-size: 40px;
      text-align: center;
      font-family: Edwardian_Script;
      margin-top: 5px;
    }

    #clock .num-wrapper {
      margin-top: 5px;
    }

    #clock .group-wrapper {
      display: inline-block;
      margin: 10px;
    }

    @font-face {
      font-family: Edwardian_Script;
      src: url('Edwardian_Script_ITC.otf');
    }

    @font-face {
      font-family: PT_Serif;
      src: url('PT_Serif.ttf');
    }

  </style>
  <template>
    <div id="clock">
      <div class="group-wrapper">
        <div class="num-wrapper">
          <span class="num" id="days0">[[time.0]]</span>
          <span class="num" id="days1">[[time.1]]</span>
          <span class="num" id="days2">[[time.2]]</span>
        </div>
        <div class="header">Days</div>
      </div>
      <div class="group-wrapper">
        <div class="num-wrapper">
          <span class="num" id="hours0">[[time.3]]</span>
          <span class="num" id="hours1">[[time.4]]</span>
        </div>
        <div class="header">Hours</div>
      </div>
      <div class="group-wrapper">
        <div class="num-wrapper">
          <span class="num" id="minutes0">[[time.5]]</span>
          <span class="num" id="minutes1">[[time.6]]</span>
        </div>
        <div class="header">Minutes</div>
      </div>
      <div class="group-wrapper">
        <div class="num-wrapper">
          <span class="num" id="seconds0">[[time.7]]</span>
          <span class="num" id="seconds1">[[time.8]]</span>
        </div>
        <div class="header">Seconds</div>
      </div>
    </div>
  </template>
</dom-module>

<script>
  console.log("test");
  Polymer({
    is: 'my-countdown',
    /***
     * @private
     * @type String
     * @default '000000'
     */
    time: '000000000',
    /***
     * @private
     * @default null
     */
    timer: null,
    /***
     * @private
     * @default null
     */
    toDate: null,

    properties: {

    },
    /**
     * The `_createCountdown` method create a countdown
     *
     * @method _createCountdown
     * @private
     */
    _createCountdown: function() {
      this.time = this.timer.subtract(1, 's').format('DDDHHmmss');
      if (this.time.length < 9) {
        document.getElementById("days0").hidden = true;
      }
      this.async(this._createCountdown, 1000);
    },

    ready: function() {
      console.log("ready");
      var now = new Date();
      if (!this.toDate) {
        var defaultToDate = new Date(2016, 3, 8, 17, 30, 0);
        this.toDate = new Date(defaultToDate.getTime() +
                               defaultToDate.getTimezoneOffset() * 60000 -
                               (4 * 3600 * 1000));
      }

      this.timer = moment(new Date(this.toDate - now));

      this._createCountdown();
    }
  });
</script>
